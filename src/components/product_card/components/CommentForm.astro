---
import RatingReview from './RatingReview.astro'
interface Props {
  productId: number
}

const { productId } = Astro.props
---

<section>
  <div class="max-w-[85rem] py-10 sm:px-6 lg:px-8 lg:py-14 mx-auto">
    <div class="mx-auto max-w-2xl">
      <div class="text-center">
        <h2 class="text-xl text-gray-800 font-bold sm:text-3xl dark:text-white">
          Добавить отзыв
        </h2>
      </div>
      <!-- Card -->
      <div
        class="mt-5 p-4 relative z-10 bg-white border rounded-xl sm:mt-10 md:p-10 dark:bg-gray-800 dark:border-gray-700"
      >
        <form id="commentForm">
          <div class="mb-4 sm:mb-8">
            <label
              for="hs-feedback-post-comment-name-1"
              class="block mb-2 text-sm font-medium dark:text-white"
              >Имя*
            </label>
            <input
              type="text"
              name="author_name"
              id="hs-feedback-post-comment-name-1"
              class="py-3 px-4 block w-full border border-gray-200 rounded-lg text-sm focus:border-blue-500 focus:ring-blue-500 disabled:opacity-50 disabled:pointer-events-none dark:bg-slate-900 dark:border-gray-700 dark:text-gray-400 dark:focus:ring-gray-600"
              placeholder="Ваше имя"
            />
          </div>
          <div class="mb-4 sm:mb-8">
            <label
              for="hs-feedback-post-comment-email-1"
              class="block mb-2 text-sm font-medium dark:text-white"
              >Email*</label
            >
            <input
              type="email"
              name="email"
              id="hs-feedback-post-comment-email-1"
              class="py-3 px-4 border block w-full border-gray-200 rounded-lg text-sm focus:border-blue-500 focus:ring-blue-500 disabled:opacity-50 disabled:pointer-events-none dark:bg-slate-900 dark:border-gray-700 dark:text-gray-400 dark:focus:ring-gray-600"
              placeholder="Ваш email"
            />
          </div>
          <div class="mb-2 sm:mb-2">
            <label
              for="hs-feedback-post-comment-textarea-1"
              class="block mb-2 text-sm font-medium dark:text-white"
            >
              Отзыв*
            </label>
            <div class="mt-1">
              <textarea
                id="hs-feedback-post-comment-textarea-1"
                name="comment"
                class="py-3 px-4 block w-full border border-gray-200 rounded-lg text-sm focus:border-blue-500 focus:ring-blue-500 disabled:opacity-50 disabled:pointer-events-none dark:bg-slate-900 dark:border-gray-700 dark:text-gray-400 dark:focus:ring-gray-600"
                placeholder="Напишите ваш отзыв здесь..."></textarea>
            </div>
          </div>

          <!--Accordion-->
          <div class="hs-accordion-group mb-2 sm:mb-2">
            <div
              class="hs-accordion mb-2 sm:mb-3"
              id="hs-basic-with-title-and-arrow-stretched-heading-three "
            >
              <button
                type="button"
                class="hs-accordion-toggle hs-accordion-active:text-blue-600 py-3 inline-flex items-center justify-between gap-x-3 w-full font-semibold text-start text-gray-800 hover:text-gray-500 rounded-lg disabled:opacity-50 disabled:pointer-events-none dark:hs-accordion-active:text-blue-500 dark:text-gray-200 dark:hover:text-gray-400 dark:focus:outline-none dark:focus:text-gray-400"
                aria-controls="hs-basic-with-title-and-arrow-stretched-collapse-three"
              >
                Преимущества и недостатки
                <svg
                  class="hs-accordion-active:hidden block w-4 h-4"
                  xmlns="http://www.w3.org/2000/svg"
                  width="24"
                  height="24"
                  viewBox="0 0 24 24"
                  fill="none"
                  stroke="currentColor"
                  stroke-width="2"
                  stroke-linecap="round"
                  stroke-linejoin="round"><path d="m6 9 6 6 6-6"></path></svg
                >
                <svg
                  class="hs-accordion-active:block hidden w-4 h-4"
                  xmlns="http://www.w3.org/2000/svg"
                  width="24"
                  height="24"
                  viewBox="0 0 24 24"
                  fill="none"
                  stroke="currentColor"
                  stroke-width="2"
                  stroke-linecap="round"
                  stroke-linejoin="round"><path d="m18 15-6-6-6 6"></path></svg
                >
              </button>
              <div
                id="hs-basic-with-title-and-arrow-stretched-collapse-three"
                class="mb-1 hs-accordion-content hidden w-full overflow-hidden transition-[height] duration-300"
                aria-labelledby="hs-basic-with-title-and-arrow-stretched-heading-three"
              >
                <div class="mb-4 sm:mb-8">
                  <label
                    for="hs-feedback-post-plus"
                    class="block mb-2 text-sm font-medium dark:text-white"
                    >Преимущества
                  </label>
                  <input
                    type="text"
                    name="advantages"
                    id="hs-feedback-post-plus"
                    class="py-3 px-4 block w-full border border-gray-200 rounded-lg text-sm focus:border-blue-500 focus:ring-blue-500 disabled:opacity-50 disabled:pointer-events-none dark:bg-slate-900 dark:border-gray-700 dark:text-gray-400 dark:focus:ring-gray-600"
                    placeholder="Опишите преимущества продукта"
                  />
                </div>
                <div>
                  <label
                    for="hs-feedback-post-minus"
                    class="block mb-2 text-sm font-medium dark:text-white"
                    >Недостатки
                  </label>
                  <input
                    type="text"
                    name="disadvantages"
                    id="hs-feedback-post-minus"
                    class="py-3 px-4 block w-full border border-gray-200 rounded-lg text-sm focus:border-blue-500 focus:ring-blue-500 disabled:opacity-50 disabled:pointer-events-none dark:bg-slate-900 dark:border-gray-700 dark:text-gray-400 dark:focus:ring-gray-600"
                    placeholder="Опишите недостатки продукта"
                  />
                </div>
              </div>
            </div>
          </div>

          <RatingReview />

          <div class="flex items-center">
            <input
              type="checkbox"
              class="h-5 w-5 mt-0.5 border-gray-200 rounded text-blue-600 focus:ring-blue-500 disabled:opacity-50 disabled:pointer-events-none dark:bg-gray-800 dark:border-gray-700 dark:checked:bg-blue-500 dark:checked:border-blue-500 dark:focus:ring-offset-gray-800"
              id="hs-checked-checkbox"
              name="recommend"
              checked
            />
            <label
              for="hs-checked-checkbox"
              class="text-gray-500 ms-3 dark:text-gray-400"
              >Я рекомендую этот товар</label
            >
          </div>
          <input type="hidden" name="product_id" value={productId} />

          <div class="mt-6 grid">
            <button
              type="submit"
              class="w-full py-3 px-4 inline-flex justify-center items-center gap-x-2 text-sm font-semibold rounded-lg border border-transparent bg-blue-600 text-white hover:bg-blue-700 disabled:opacity-50 disabled:pointer-events-none dark:focus:outline-none dark:focus:ring-1 dark:focus:ring-gray-600"
              >Отправить</button
            >
          </div>
        </form>
      </div>
      <!-- End Card -->
    </div>
  </div>
</section>

<script>
  const form = document.getElementById('commentForm')
  async function sendRequest(event) {
    event.preventDefault()
    const formData = new FormData(form)
    const data = {}

    formData.forEach((value, key) => {
      if (value.trim() !== '') {
        data[key] = value
      }
    })

    try {
      const response = await fetch('http://127.0.0.1:8000/reviews', {
        method: 'POST',
        body: JSON.stringify(data),
        headers: {
          'Content-Type': 'application/json',
        },
      })

      if (!response.ok) {
        throw new Error('Ошибка при отправке данных')
      }

      if (response.ok) {
        console.log('resp ok')
      }
    } catch (error) {
      console.error(error)
    }
  }

  form.addEventListener('submit', sendRequest)
</script>
